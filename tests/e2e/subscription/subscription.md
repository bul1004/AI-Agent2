### サブスクリプション (`subscription`)

- Stripe 連携のサブスクリプションモーダル表示、プラン情報、チェックアウト開始が正しく動作することを確認

#### テストケース

| テスト名                                                           | 確認事項                                             |
| ------------------------------------------------------------------ | ---------------------------------------------------- |
| `未契約ユーザーがサブスクリプションモーダルを閲覧できる`           | モーダルが開き、未契約状態として「今すぐ始める」表示 |
| `Businessプランの詳細が正しく表示される`                           | プラン名・価格・特徴（30日間返金保証など）が表示     |
| `チェックアウトフローが開始できる（Stripeにリダイレクト）`         | ボタンクリック後に checkout.stripe.com へリダイレクト |
| `契約中ユーザーは契約中ステータスが表示される（DBモック）`         | DBモックを使用した契約中UI確認（現時点は未契約のみ） |
| `未ログインユーザーは/chatにアクセスするとログインにリダイレクト`  | /chat へ未認証アクセス → /login へリダイレクト       |
| `組織未選択時はチェックアウトボタンをクリックしても何も起きない`   | 組織なしでチェックアウト → /chat に留まる            |

#### 手順（サブスクリプションモーダル表示 - ハッピーパス）

1. テストユーザーを新規作成してログイン状態にする
2. /chat ページに移動
3. プロフィールアバターボタンをクリック
4. 「アップグレード」ボタンをクリック
5. サブスクリプションモーダルが表示されることを確認
6. 「今すぐ始める」ボタンが表示されることを確認（未契約状態）

#### 手順（Businessプラン詳細確認）

1. テストユーザーを新規作成してログイン状態にする
2. サブスクリプションモーダルを開く（上記手順 2-5）
3. プラン名「Business」が表示されることを確認
4. 価格「¥9,800」が表示されることを確認
5. 「30日間返金保証」が表示されることを確認

#### 手順（チェックアウト開始）

1. テストユーザーを新規作成してログイン状態にする
2. 組織を作成する（サブスクリプションは組織単位）
3. サブスクリプションモーダルを開く
4. 「今すぐ始める」ボタンをクリック
5. checkout.stripe.com にリダイレクトされることを確認

#### 手順（未ログインリダイレクト）

1. ログインせずに /chat にアクセス
2. /login にリダイレクトされることを確認

#### 手順（組織未選択時のチェックアウト）

1. テストユーザーを新規作成してログイン状態にする（組織は作成しない）
2. サブスクリプションモーダルを開く
3. 「今すぐ始める」ボタンをクリック
4. /chat に留まることを確認（Stripe へリダイレクトされない）

#### 前提条件

- `STRIPE_SECRET_KEY` / `STRIPE_PRICE_ID_BUSINESS` が設定されていること
- Stripe テスト環境が設定済みであること
- 契約中ユーザーのテストには `npx tsx scripts/seed-stripe-test-data.ts` でテストデータを作成

#### 使用するページオブジェクト

| クラス        | 用途                                     |
| ------------- | ---------------------------------------- |
| `BillingPage` | サブスクリプションモーダルの操作・検証   |

#### 使用する data-testid

| セレクタ                | 要素                       |
| ----------------------- | -------------------------- |
| `profile-avatar-button` | プロフィールアバターボタン |

#### 備考

- 各テスト後に `cleanupTestUser` でテストユーザーをクリーンアップ
- auth/fixtures.ts の共通ヘルパー（`createTestUser`, `createOrganization`）を使用
- Stripe Checkout UI の操作は自動E2Eの対象外（後述の README 参照）

